<!DOCTYPE html>
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>分析式</title>
<link rel="stylesheet" type="text/css" href="style.css">
<style>
li{margin:0.6em 0em;}
</style>
</head>
<body marginwidth=50>
<h1>葦手入力　仕様書</h1>
<p>中山春明　記</p>
<p>　この文書は、葦手入力を改変・応用するために、開発者向けに書いたものである。入力法の仕組みや、開発用ファイルの構造について、解説する。</p>
<h2>目次</h2>
<ul>
<li>○入力法</li>
<li>○分析式</li>
<li>○プログラム</li>
</ul>
<hr></hr>
<h2>分析式</h2>
<div name="1">
<h3>概要</h3>
<p>　葦手入力の打鍵は、必ず一定の規則に従つて字形を分析させることで、字の形から一意に決定できることを指向した。打鍵を与えるに当たつて、それを機械的に定めるために個々の文字の構造を式に定義したもの（分析式）の表が、「文字分析表」である。分析式は、一定の方式に則つて記述され、最終的に機械処理が施されてこれによつて打鍵が生成される。<br>
　分析式は、直截に文字の打鍵列を記述するのでなく、その文字がどのやうな偏旁や点画がどのやうに組み立てられて成り立つてゐるかを分析して記述する。プログラムの処理にかけると、それらの偏旁や点画はさらに分析されて、小さい偏旁や点画の単位に開かれる。分析を重ねて最終的にその文字は、最小単位である字素の組み合はせとして表される。その字素を対応する字母に置き換へて、字の結構に従つてその中から規則的に五字母を取り出すことで、実際の打鍵が生成される。<br>
　文字には「独体字」と「合体字」とがある。独体字は、六書の象形・指事に当り、部分に分解し得ない文字。合体字は六書の形声・会意に当り、いくつかの部分に分解される文字である。合体字は独体字や符号が集まつて出来てゐる。理論的には、これらの独体字や符号に字素を指定しておけば、合体字まで網羅でき、すべての字に打鍵を与へられる。しかし、楷書体の漢字は歴史上形の変遷を伴つてをり、必ずしも形と字源とがきれいに対応しない。「水・江・桼・益」「火・然・尉・粦」のやうに篆書でもともと同じ形であつたものが異なる形になつたり、「秦・奏・春・泰・舂」あるいは「明・服・腹」のやうに元々異なる形であつたものが、同一になつたりしてゐる。入力方式を作るならば、字源的要素を完全に排除して形のみから字を構成する要素を与へることも可能であるが、しかしながら、元の字とそこから変化して成り立つ形との対応関係を規定しておくことで、特定の字素の打鍵を後から改変しやすくしたり、異体字の生成などに応用することができるので、有機的な運用がのぞめる。<br>
　今、字源要素として働く文字及び文字の変形を「偏旁」と称し、字源要素でなく字の形を構成するにすぎない点や画もしくはその集まりを「点画」と称する（ただし、ここにいふ「偏旁」「点画」を含めて、ひろく文字を構成する要素のことをまとめて「偏旁」と呼ぶことも一般にあるので、その用法に従ふ場合もある）。<br>
　文字分析表は、文字入力の対象となる「文字」（正確には符号化文字）の分析、つまり、その文字の形が、どのやうな要素（偏旁）によつて、どのやうな組み立て方（結構）で、成り立つてゐるかを定義したものである。この表中の文字は他の合体字の偏旁にもなることができる。一方、元来は文字でなく偏旁や点画としてのみ用ゐられる形については、別に「点画偏旁分析表」において、その分析が定義され、あるいはその点画が字素にあたるものであれば、その対応する字母が定義される。つまり、打鍵の生成の手順は、文字分析表から入力対象の文字の分析式を参照して、その中の偏旁や点画の分析式を文字分析表と点画偏旁分析表から参照して、より細かい要素で記述された分析式に開き、さらにそれを細かく参照していき、最終的に字素のみで記述された分析式にまで展開される。この字素を字母に置き換へて、その中から結構ごとの規則に従つて特定の五つ以下の字母を取り出すことで、実際の打鍵が成立する。これにより文字表の全ての文字に打鍵を付与し、それを打鍵表として出力する。以上の処理は規則によつてすべて機械的に行はれる。機械的に行はれることで、入力する者は形から一意に打鍵を特定することができる。<br>
　打鍵の生成は、分析式を材料とする。分析式の構造は、簡明で扱ひやすく改変しやすいしくみが望まれる。</p>

<hr></hr>
<h3>分析式規則</h3>
<ul>
<li>入力対象となる文字は、文字分析表において分析式を記述する。入力対象にならず、分析式の要素としてのみ利用される偏旁や点画は、点画偏旁分析表において記述する。</li>
<li>ある字が「特殊分析字」で、単字の場合と偏旁の場合とで異なる分析が与へられる場合、同一の見出しを文字表と点画偏旁表とそれぞれに置き、前者に単字の式を、後者に偏旁の式を記す。（たとへば、曰字を、単字の場合日字との重複を避け「^囗0,一0」とし、偏旁の場合日字との辨別を無くし共に「ヨ」とする。）</li>
<li>点画偏旁分析表中、字素となる点画は、対応する字母一字を記述する。</li>

</ul>
<hr></hr>
<h3>分析式記述法</h3>

<ul>
<li>式は、どのやうな要素がどのやうに組み合はさつてゐるかを記述する。要素は二項単位でその組み合はさり方を記す。要素の組み合はさり方を示す符号は二項の前に置く。三要素以上より成る字は、二項を結合せしめたものを一項とし又一項と結合して括つていく（「山」と「上」と「下」とからなる「峠」は「山」と「上下」との左右の結合とみなす。「上下」は「上」と「下」との上下の結合とする。よつてその式は「峠:-山,/上,下」）。</li>
<li>要素を配列する順序は、以下の規則に従ふ。
<ul>
<li>上に在る要素を前に、下に在る要素を後ろに配列する。</li>
<li>左に在る要素を前に、右に在る要素を後ろに配列する。</li>
<li>外に在る要素を前に、内に在る要素を後ろに配列する。</li>
</ul></li>
<li>結構の記述は、要素の配置関係を表す符号を、その二項に前置することで為す。項は(,)で区切る。符号は次のごとくである。
	<table style="padding-left: 2em;">
	<tr><th></th><th></th></tr>
	<tr><td>-</td><td>並ぶ者</td><td>【地:-土,也】【超:-走,召】</td></tr>
	<tr><td>/</td><td>重なる者</td><td>【宇:/宀,于】【懲:/徵,心】</td></tr>
	<tr><td>^</td><td>覆ふ者</td><td>【國:^囗,或】【閏:^門,王】【匣:^匚,甲】【戒:^戈,廾】</td></tr>
	<tr><td>~</td><td>被さる者</td><td>【病:~疒,丙】【釐:~𠩺,里】【魔:~麻,鬼】</td></tr>
	<tr><td>_</td><td>掬ふ者</td><td>【進:_隹,辵1】【幽:_𢆶,山】【臿:_干,臼】</td></tr>
	<tr><td>b</td><td>橫に挾む者</td><td>【衢:b行,瞿】</td></tr>
	<tr><td>c</td><td>縱に挾む者</td><td>【褒:c衣,保】</td></tr>
	<tr><td>.</td><td>添はる者</td><td>【刅:.刃,一1】【戉:.戈,𠄌】</td></tr>
	<tr><td>"</td><td>割る者</td><td>【夾:"大,|人,人】【東:"木,日】【繭:/艸1,"巾0,-糸,虫】</td></tr>
	<tr><td>+</td><td>交はる者</td><td>【內:+冂,入】【牽:/+玄,冖0,牛】</td></tr>
	<tr><td>&</td><td>接する者</td><td>【立:&亠0,DPH】【亦:&亠0,"SPSG,八0】</td></tr>
	</table>
</li>
<li>要素が三項以上より成る場合、二項を結合させてから餘の一項と結合する。<br>
	結合の順序は、第一に結構に基づき、小さい部分を先に結合し、大きい部分を後に結合する。<br>
		<div style="padding-left: 2em;">冠:/冖,-元,寸<br>
		峠:-山,/上,下</div>
	また、大小無く等しく並立する場合、離れた要素同士よりも接する要素同士を先に結合し、接する要素同士より交はる要素同士を先に結合する。<br>
		<div style="padding-left: 2em;">盍:/&土0,厶0,皿<br>
		者:/+土0,丿0,日0</div>
	以上の関係が等しい場合は、後方から結合する。<br>
		<div style="padding-left: 2em;">嫐:-女,-男,女<br>
		冥:/冖,/日,六</div>
</li>
<li>独体字の分析は直ちに点画によつて記述する。独体字の形は、意味のない点や画の集合であるからである。</li>
<li>合体字の分析は偏旁や点画の組み合はせによつて記述し、なるべく字源的な要素を保つやうに分析する。</li>
<li>元来合体して成り立つてゐる字や偏旁でも、形の変化を蒙つて既定の偏旁に形を分析できない形のものは、独体字に準じて点画によつて記述する。</li>
<li>独体字でも字源的に分析すると打鍵抽出の規則に噛み合はなくなる場合は、点画に分析する。打鍵としての捉へ易さを優先するためである。</li>
<li>字源の解釈は、説文解字の説による。字典の字形が説文解字以下の字書の説に則つてゐるためである。説文解字にない文字は、字典が依拠する字書や歴代の字書を参照し、或いは字形・音韻・意義等を根拠に規定する。</li>
<li>偏旁は字源としての価値を持つため、ある文字が既定の偏旁と同じ形の要素を有してゐても、その字源がその偏旁と同一であるか、字源は異なるが譌変によつて交替して成り立つてゐるかのいづれでもない場合、それによつて記述しない。（たとへば、月に従ふ字、肉月に従ふ字、舟月に従ふ字、それぞれ月・肉・舟の變化によつて記述する。譌変形は、たとへば「得」の「彳」が「氵」に譌して「淂」となり、「筆」の「竹」が「艹」に譌して「茟」となる類である。譌変して出来た偏旁形は、字源的には本来の偏旁と一致しないものであるが、これをその形の偏旁と同一に扱ふ理由としては、時に譌変後の偏旁の意味合ひを帯びることがあることや、隷変が形の変革の産物であるのに対して、譌変は形の紛れによるものであり偏旁を取り違へて意識したことで成立したものであること、また、譌変形に対して個々に偏旁の見出しを設けていくと乱立する、といつたことがあげられる。偏旁形と譌変との違ひは、隷変における変化か、隷書以後の行書形などにおける混同によるものかの違ひであるが、「竹」と「艹」との混同が隷変時に起こつてゐるやうに、正確な基準はないため、究極は運用上の利便に従ふ。）</li>
<li>同一の文字符号において複数の字形があてられてゐる場合は、(:)を以て式を分かち、それぞれを記述する。</li>
<li>その文字が偏旁になつた場合の合体字にも同様にそれに従つた複数の字形を有する場合、点画偏旁分析表に複数の字形を記述して参照させることも可能である。（節・卽）</li>
</ul>
<hr></hr>
<h4>点画偏旁表用法</h4>
<ul>
<li>点画偏旁分析表に配するものは、文字の要素となる点画・偏旁、また、単字と偏旁とで分析が異なる文字の偏旁の場合の分析、ある字を偏旁になると一つの文字符号に複数の分析がある</li>
<li>偏旁は、本字に任意の番号をつけた見出しを与へる。
	<div style="padding-left: 2em;">水1　……江洪衍<br>
	水2　……泰桼滕<br>
	水3　……益<div></li>
<li>偏旁の分析式は、偏旁や点画を組み合はせて記述する。</li>
<li>点画は、任意の文字列によつて見出しを設ける。（実際のファイルでは、類する形の文字に「0」を添へるか、CJK Strokeの記号でつけてある）<br>
	<div style="padding-left: 2em;">丆0;夏寡憂<br>
	日0;亯亰<br>
	HSZ;丣㐄兂𠑶𠑹<br>
	HGD;予𠈃𠈴疑</div></li>

<li>一つの文字符号に複数の形態が与へられてゐる場合、その変化の種類をラテン字母の大文字を添へて見出しを設ける。
	<div style="padding-left: 2em;">曾A:/八1,/𡆧1,曰<br>
	曾B:/丷0,/田0,曰</div>
	<div style="padding-left: 2em;">　「曾」の分析式を【曾:曾A】と記すことで、曾を含む文字は、たとへば【僧:-人1,曾】と記せば、フォントの字形にかかはらず「曾A」の形によつて設定される。もし、曾を含む文字の全てを「曾B」の形に設定したい場合、「曾」の分析式を【曾:曾B】とすることで一括して置き換はる。殊更に符号によつて字形が分離されてゐる場合、直截「曾A」「曾B」を参照して【增:-土,曾A】【増:-土,曾B】と記すことで分離できる。</div></li>
	</ul>
<hr></hr>
<h4>特殊規則</h4>
<ul>
<li>形が酷似して、常の如く分析すると打鍵に違ひが無くなる文字は、規則に違反しない範囲で、異なる分析記述を与へる。（特殊分析字）</li>

<li>特定の偏旁による特定の結構においては、特殊の分析法によつて記述する。（結構固定偏旁）</li>

<li>集合指定
特定の文字集合における字形を設定する場合、=によつて符号を後置する。</li>
</ul>

<ul>

<li>単字に添へる肩の「丶」は、偏旁においては省略して記述する。（书发圡尤弋戈曵朮术求犬犮玉甫）</li>
</ul>

<h3>・字素式生成法</h3>

<p>　拆字式は、最終的にこれ以上ひらけない最小の字素のみの分析式にされる。これを字素式とする。<br>
<div style="padding-left: 2em;">蔀:/艸1,部　→　/艹0,-/&亠0,DPH,口0,&㇌0,丨0（/サ,-/&ユ,サ,ロ,.ア,シ）</div><br>
　字素式を生成するに当たつて、式を打鍵に正しく変換するための適合化の処理が為される。</p>
<ol>
<li>覆ひ符号(^)が連続する場合、符号を前方に一箇残して、餘の後ろの同符号は一つづゝ後ろに回して重なり符号（/）に改める。
	<div style="padding-left: 2em;">【^(^Aa,Ab),B】=>【^Aa,/Ab,B】</div></li>
<li>被さり符号(~)が連続する場合、符号を前方に一箇残して、餘の後ろの同符号は一つづゝ後ろに回して重なり符号（/）に改める。
	<div style="padding-left: 2em;">【~(~Aa,Ab),B】=>【~Aa,/Ab,B】</div>
	<div style="padding-left: 2em;">【磨:~麻,石】→【~ラ,/-ホ,ホ,~フ,ロ】（【~~广,𣏟,石】→【~广,/𣏟,石】相当）</div></li>

<li>縦挟み符号(c)で括られた前字後字は、前字後項と後字とを重なり符号(/)で括つて後項となし、前字の前項を前項となして重なり符号(/)で括る。
	<div style="padding-left: 2em;">【c(/Aa,Ab),B】=>【/Aa,/B,Ab】</div></li>

<li>並び符号(-)が連続する場合、後方に括り改める。
	<div style="padding-left: 2em;">【-(-Aa,Ab),B】=>【-Aa,-Ab,B】</div>
	<div style="padding-left: 2em;">（例）<br>頥:--丨0,臣,頁    →　-シ,-^ヒ,&シ,&コ,シ,/&フ,.ヮ,ニ,ハ（【-丨0,-臣,頁】相当）<br>鴻:-江,鳥　→　鴻:-シ,-エ,.イ,.ヨ,.ー,^フ,ツ　（【-水1,-工,鳥】相当）</div></li>

<li>重なり符号(/)が連続する場合、後方に括り改める。
	<div style="padding-left: 2em;">【/(/Aa,Ab),B】=>【/Aa,/Ab,B】</div></li>

<li>被さり符号(~)に重なり符号(/)が連続する場合、後方を被さり符号で括り後項とし、前項と重なり符号で括る。
	<div style="padding-left: 2em;">【~(/Aa,Ab),B】=>【/Aa,~Ab,B】</div></li>
</ol>
</div>
<hr></hr>

</div>
</body>
</html>